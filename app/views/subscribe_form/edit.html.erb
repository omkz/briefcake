<div class="mt-16 max-w-4xl mx-auto">
  <h1 class="text-3xl mb-1">Create personal newsletter</h1>

  <div class="w-full flex">
    <div class="w-full md:w-1/2">
      <div class="pb-6 pr-10 text-gray-600">
        <p class="mb-4">If you want to provide your readers with a really simple email newsletter you can use this form. You get your own personal link which you can use on your own site.</p>
        <p>More information about this can <%= link_to "be found here", about_rss_newsletter_path %>.</p>

      </div>
      <% if @subscribe_form.persisted? %>
        <div class="bg-green-500 text-white p-5 py-3 mb-8 shadow-lg rounded relative">
          <p>Your sign up form is now publicly available at: </p>
          <p><%= link_to subscribe_url(slug: @subscribe_form.slug), subscribe_url(slug: @subscribe_form.slug), class: "color-white underline hover:no-underline" %></p>
        </div>
      <% end %>

      <div class="card card--light mb-8" data-controller="feed-url">
        <%= form_for(@subscribe_form, url: subscribe_form_path, method: :patch) do |form| %>
          <div class="card__content">
            <div class="field">
              <%= form.label :name, "Name of website" %>
              <%= form.text_field :name, class: "input" %>
            </div>

            <div class="field">
              <%= form.label :slug, "Pick a url (needs to be unique)" %>
              <%= form.text_field :slug, class: "input" %>
              <% if @subscribe_form.errors.added?(:slug, "has already been taken") %>
                <div class="text-xs pt-1 text-red-600">This name is taken or reserved.</div>
              <% else %>
                <div class="text-xs pt-1 text-gray-600">This is what gets used for your custom url.</div>
              <% end %>
            </div>

            <div class="field">
              <%= form.label :url, "Website url" %>
              <div class="flex">
                <%= form.url_field :url, class: "w-auto input rounded-r-none flex-grow", data: { target: "feed-url.url" } %>
                <div class="whitespace-no-wrap bg-blue-600 rounded overflow-hidden rounded-l-none flex items-center justify-around" style="min-width: 100px">
                  <button type="button" class="text-white px-3 hover:bg-blue-900 px-4 h-full inline-block" data-target="feed-url.checkButton" data-action="click->feed-url#check">Find RSS feed</button>
                  <div class="hidden loader-spinner pointer-events-none" data-target="feed-url.loader" style="border-color: white; border-bottom-color: transparent"></div>
                </div>
              </div>
            </div>

            <div class="field">
              <%= form.label :feed_url, "Feed url" %>
              <%= form.url_field :feed_url, class: "input", data: { target: "feed-url.feedUrlInput" } %>
            </div>

            <div class="pt-8">
              <%= form.submit @subscribe_form.persisted? ? 'Update' : 'Create your form', class: "btn btn--primary", data: { target: "feed-url.submitButton" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="w-1/2 hidden md:block relative">
      <% if @subscribe_form.persisted? %>
        <%= render "pages/chrome" do %>
          <iframe src="<%= @preview_path %>" class="w-full" style="height: 400px"/>
        <% end %>
      <% end %>
    </div>
  </div>
</div>

